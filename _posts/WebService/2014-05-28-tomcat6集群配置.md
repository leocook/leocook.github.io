---
layout: post
comments: true
date: 2014-05-28
categories: WebService
tags: tomcat
---

* content
{:toc}

# 1.概要
web容器在做集群配置时，有3点需要注意
- 负载均衡配置；
- session共享；
- 若做的是单机集群（多个tomcat安装在同一台机器上），需要注意端口冲突问题。

**环境**

- tomcat6
- apache
- mod_jk-1.2.28-httpd-2.2.3.so




# 2.Apache配置
在本案例中是使用Apache来做的，下边用到的mod模块和Apache版本需要兼容才行。文中所使用的软件，会在文章底部附上下载链接。

## 2.1.http.conf配置修改
在apache安装目录的conf目录下，修改http.conf配置文件，在任意某一行加入

```
Include conf/mod_jk.conf
```

修改Apache监听端口（在文件的第46行左右）

```
Listen 90
```

## 2.2.mod_jk.conf配置修改
在conf目录下新建文件mod_jk.conf，写入如下内容

```
#加载mod_jk Module  把mod_jk-1.2.28-httpd-2.2.3.so放到相应的目录中
LoadModule jk_module modules/mod_jk-1.2.28-httpd-2.2.3.so
#指定 workers.properties文件路径
JkWorkersFile conf/workers.properties
#指定那些请求交给tomcat处理,"controller"为在workers.properties里指定的负载分配控制器
JkMount /*.jsp  controller
JkMount /*.action  controller

```
其中，mod_jk-1.2.28-httpd-2.2.3.so文件更具自己实际添加的模块文件名来写。

## 2.3.workers.properties配置修改
在conf目录下新建文件workers.properties，写入如下内容

```
worker.list=controller,tomcat1,tomcat2

#tomcat1
worker.tomcat1.port=8109         #ajp13端口号在tomcat下server.xml配置,默认8009 默认与HTTP通信的协议
worker.tomcat1.host=localhost     
worker.tomcat1.type=ajp13          #tomcat的主机地址，如不为本机，请填写ip地址
worker.tomcat1.lbfactor = 1       #server的加权比重，值越高，分得的请求越多

#tomcat2
worker.tomcat2.port=9109       
worker.tomcat2.host=localhost 
worker.tomcat2.type=ajp13
worker.tomcat2.lbfactor = 1  

#========controller,负载均衡控制器========
worker.controller.type=lb    
worker.controller.balanced_workers=tomcat1,tomcat2    #指定分担请求的tomcat
worker.controller.sticky_session=1
```

其中tomcat上ajp13协议通信端口需要根据具体的设置区修改（ajp13协议在这里就是Apache与tomcat之间的通信协议）。

# 3.Tomcat配置

## 3.1 tomcat的关闭端口
默认是8005，若同一台机器上配置了多个tomcat，这里必须要修改：

```
<Server port="8005" shutdown="SHUTDOWN">
```

## 3.2.tomcat的服务端口
默认是8080，若同一台机器上配置了多个tomcat，这里必须要修改：

```
<Connector port="8080" protocol="HTTP/1.1" 
               connectionTimeout="20000" 
               redirectPort="8443" />
```

## 3.3.AJP13通信端口
tomcat上的AJP13协议通信端口：默认是8009，这里的端口配置需要和上边文件workers.properties中的AJP13协议端口配置相对应，若同一台机器上配置了多个tomcat，这里必须要修改：

```
<Connector port="8009" protocol="AJP/1.3" redirectPort="8443" />
```

## 3.4.Session共享
- 在Tomcat中启用标签

```
<Cluster className="org.apache.catalina.ha.tcp.SimpleTcpCluster"/>
```

- 在web项目中的web.xml中加入

```
<distributable/>
```

则这个项目就支持集群了。
到此，配置完毕。
下载链接： http://pan.baidu.com/s/1mgLq8Dq











