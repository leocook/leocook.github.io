<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Elk安装配置介绍</title>
    <meta name="description" content="es是接触的比较早，在13年就做过相关开发，后来使用过ELK来做一些数据统计。最近打算从头来梳理一下这块的东西，今天就先从安装和配置开始吧。">

    <link rel="shortcut icon" href="/favicon.ico?" type="image/x-icon">
    <link rel="icon" href="/favicon.ico?" type="image/x-icon">
    <link rel="stylesheet" href=" /css/fontawesome/css/font-awesome.min.css ">
    <link rel="stylesheet" href=" /css/main.css ">
    <link rel="canonical" href="http://leocook.github.io/2016/07/20/ELK%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE%E4%BB%8B%E7%BB%8D/">
    <link rel="alternate" type="application/rss+xml" title="leocook" href="http://leocook.github.io /feed.xml ">


    <script>
    // 百度统计代码
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?f1ad6f37c7565a0fbaf172ac83132650";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
    </script>


<script type='text/javascript'>
      var _vds = _vds || [];
      window._vds = _vds;
      (function(){
        _vds.push(['setAccountId', 'b628e9072406c903']);
        (function() {
          var vds = document.createElement('script');
          vds.type='text/javascript';
          vds.async = true;
          vds.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + 'dn-growing.qbox.me/vds.js';
          var s = document.getElementsByTagName('script')[0];
          s.parentNode.insertBefore(vds, s);
        })();
      })();
  </script>
</head>


  <body>

    <header>
    <div class="wrapper">
        <a href="/" class="brand">leocook</a>
        <small>Big-Data Dev Engineer</small>
        <button id="headerMenu" class="menu"><i class="fa fa-bars"></i></button>
        <nav id="headerNav">
            <ul>
                <li>
                    
                    <a href="/">
                    
                        <i class="fa fa-home"></i>Home
                    </a>
                </li>

                
                    
                    <li>
                        
                        <a href="/archive/">
                        
                            <i class="fa fa-archive"></i>Archives
                        </a>
                    </li>
                    
                
                    
                    <li>
                        
                        <a href="/category/">
                        
                            <i class="fa fa-th-list"></i>Categories
                        </a>
                    </li>
                    
                
                    
                    <li>
                        
                        <a href="/tag/">
                        
                            <i class="fa fa-tags"></i>Tags
                        </a>
                    </li>
                    
                
                    
                    <li>
                        
                        <a href="/collection/">
                        
                            <i class="fa fa-bookmark"></i>Collections
                        </a>
                    </li>
                    
                
                    
                    <li>
                        
                        <a href="/about/">
                        
                            <i class="fa fa-heart"></i>About
                        </a>
                    </li>
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            </ul>
        </nav>
    </div>
    <script type='text/javascript'>
      var _vds = _vds || [];
      window._vds = _vds;
      (function(){
        _vds.push(['setAccountId', 'b628e9072406c903']);
        (function() {
          var vds = document.createElement('script');
          vds.type='text/javascript';
          vds.async = true;
          vds.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + 'dn-growing.qbox.me/vds.js';
          var s = document.getElementsByTagName('script')[0];
          s.parentNode.insertBefore(vds, s);
        })();
      })();
  </script>
</header>


        <div class="page clearfix" post>
    <div class="left">
        <h1>Elk安装配置介绍</h1>
        <div class="label">

            <div class="label-card">
                <i class="fa fa-calendar"></i>2016-07-20
            </div>

            <div class="label-card">
                
            </div>

            <div class="label-card">
                
            </div>

            <div class="label-card">
            


<!-- <span class="point">•</span> -->
<span class="categories">
  <i class="fa fa-th-list"></i>
  
    
        <a href="/category/#ELK" title="Category: ELK" rel="category">ELK</a>
    
  

  <!-- <span class="point">•</span> -->
</span>


            </div>

            <div class="label-card">
            
<!-- <span class="point">•</span> -->
<span class="pageTag">
  <i class="fa fa-tags"></i>
  
    
        <!--a href="/tag/#es" title="Tag: es" rel="tag">es</a-->
        <a href="/tag/#es" title="Tag: es" rel="tag">es</a>&nbsp;
    
        <!--a href="/tag/#logstash" title="Tag: logstash" rel="tag">logstash</a-->
        <a href="/tag/#logstash" title="Tag: logstash" rel="tag">logstash</a>&nbsp;
    
        <!--a href="/tag/#kibana" title="Tag: kibana" rel="tag">kibana</a-->
        <a href="/tag/#kibana" title="Tag: kibana" rel="tag">kibana</a>&nbsp;
    
        <!--a href="/tag/#ELK" title="Tag: ELK" rel="tag">ELK</a-->
        <a href="/tag/#ELK" title="Tag: ELK" rel="tag">ELK</a>
    
  

</span>

            </div>

        </div>
        <hr>
        <article itemscope itemtype="http://schema.org/BlogPosting">
        <ul id="markdown-toc">
  <li><a href="#section" id="markdown-toc-section">版本列表</a></li>
  <li><a href="#logstash" id="markdown-toc-logstash">1.logstash配置</a>    <ul>
      <li><a href="#jdk" id="markdown-toc-jdk">1.1.Jdk安装</a></li>
      <li><a href="#logstash-1" id="markdown-toc-logstash-1">1.2.下载logstash</a></li>
      <li><a href="#section-1" id="markdown-toc-section-1">1.3.启动</a></li>
      <li><a href="#section-2" id="markdown-toc-section-2">1.4.验证</a></li>
    </ul>
  </li>
  <li><a href="#es" id="markdown-toc-es">2.ES</a>    <ul>
      <li><a href="#section-3" id="markdown-toc-section-3">2.1.下载</a></li>
      <li><a href="#section-4" id="markdown-toc-section-4">2.2.配置</a></li>
      <li><a href="#section-5" id="markdown-toc-section-5">2.3.启动</a></li>
      <li><a href="#section-6" id="markdown-toc-section-6">2.4.插件安装</a></li>
      <li><a href="#section-7" id="markdown-toc-section-7">2.5.验证</a></li>
    </ul>
  </li>
  <li><a href="#kibana" id="markdown-toc-kibana">3. Kibana</a>    <ul>
      <li><a href="#section-8" id="markdown-toc-section-8">3.1.下载</a></li>
      <li><a href="#section-9" id="markdown-toc-section-9">3.2.配置</a></li>
      <li><a href="#section-10" id="markdown-toc-section-10">3.3.启动</a></li>
      <li><a href="#section-11" id="markdown-toc-section-11">3.4.验证</a></li>
    </ul>
  </li>
  <li><a href="#elk" id="markdown-toc-elk">4.使ELK整体协作起来</a>    <ul>
      <li><a href="#section-12" id="markdown-toc-section-12">4.1.原理</a></li>
      <li><a href="#el" id="markdown-toc-el">4.2.E和L的连接</a></li>
      <li><a href="#kibana-1" id="markdown-toc-kibana-1">4.3.Kibana的配置</a></li>
      <li><a href="#es-1" id="markdown-toc-es-1">4.4.ES</a></li>
      <li><a href="#section-13" id="markdown-toc-section-13">5.小结</a></li>
    </ul>
  </li>
</ul>

<p>es是接触的比较早，在13年就做过相关开发，后来使用过ELK来做一些数据统计。最近打算从头来梳理一下这块的东西，今天就先从安装和配置开始吧。</p>

<h2 id="section">版本列表</h2>

<table>
  <thead>
    <tr>
      <th>project</th>
      <th>version</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>es</td>
      <td>2.3.4</td>
    </tr>
    <tr>
      <td>logstash</td>
      <td>2.3.4</td>
    </tr>
    <tr>
      <td>kibana</td>
      <td>4.5.3</td>
    </tr>
  </tbody>
</table>

<h2 id="logstash">1.logstash配置</h2>

<h3 id="jdk">1.1.Jdk安装</h3>
<p>http://www.oracle.com/technetwork/java/javase/downloads/jdk7-downloads-1880260.html</p>

<h3 id="logstash-1">1.2.下载logstash</h3>
<p>https://www.elastic.co/downloads/logstash</p>

<h3 id="section-1">1.3.启动</h3>

<p>解压后可直接启动，不增加额外的配置也是能够启动成功的。启动方式有多种，这里举例说明。</p>

<ul>
  <li>使用-e指定启动的参数</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>./logstash -e 'input { stdin { } } output { stdout {} }'
</code></pre>
</div>

<p>这里设定stdin为输入，stdout为输出。</p>

<ul>
  <li>使用配置文件启动</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>cat logstash-simple.conf
input { stdin { } }
output {
   stdout { codec=&gt; rubydebug }
}

./logstash agent -f logstash-simple.conf
</code></pre>
</div>

<h3 id="section-2">1.4.验证</h3>

<p>启动后才命令行输入”hello World”，如下：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>root@dt-vt-153:/opt/logstash/logstash-2.3.4/bin# ./logstash agent -f logstash-simple.conf

Settings: Default pipeline workers: 1
Pipeline main started
hello World
{
       "message" =&gt; "hello World",
       "@version" =&gt; "1",
       "@timestamp" =&gt; "2016-07-18T07:20:20.526Z",
       "host" =&gt; "0.0.0.0"
}
</code></pre>
</div>

<p>打印出来的message部分显示为输入内容。</p>

<h2 id="es">2.ES</h2>

<h3 id="section-3">2.1.下载</h3>
<p>https://www.elastic.co/downloads/elasticsearch</p>

<h3 id="section-4">2.2.配置</h3>
<p>配置一下主机的地址,这里不配置的话，只能在安装服务的宿主机上使用localhost来访问ES了。</p>

<div class="highlighter-rouge"><pre class="highlight"><code>vi config/elasticsearch.yml
network.host: 0.0.0.0
</code></pre>
</div>

<h3 id="section-5">2.3.启动</h3>

<div class="highlighter-rouge"><pre class="highlight"><code>/opt/elasticsearch/elasticsearch-2.3.4/bin/elasticsearch
</code></pre>
</div>

<h3 id="section-6">2.4.插件安装</h3>

<p>kopf插件安装：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>/opt/elasticsearch/elasticsearch-2.3.4/bin/plugin install lmenezes/elasticsearch-kopf
</code></pre>
</div>

<p>安装完之后，可以访问web页面http://[hostname]:9200/_plugin/kopf查看。</p>

<h3 id="section-7">2.5.验证</h3>

<p>es默认使用的9200端口，可使用下面的命令来查看该端口是否已经被监听：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>netstat -anp |grep :9200
</code></pre>
</div>

<p>或者使用浏览器访问端口9200.</p>

<h2 id="kibana">3. Kibana</h2>

<h3 id="section-8">3.1.下载</h3>
<p>https://www.elastic.co/downloads/kibana</p>

<h3 id="section-9">3.2.配置</h3>

<p>配置一下es的地址。</p>

<div class="highlighter-rouge"><pre class="highlight"><code>vi config/kibana.yml

elasticsearch.url: "http://[hostname]:9200"
</code></pre>
</div>

<p>这里默认是使用ES的数据。</p>

<h3 id="section-10">3.3.启动</h3>

<div class="highlighter-rouge"><pre class="highlight"><code>/opt/kibana/kibana-4.5.3-linux-x64/bin/kibana
</code></pre>
</div>

<h3 id="section-11">3.4.验证</h3>

<p>访问：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>http://[hostname]:5601/
</code></pre>
</div>
<p>点击”create”创建索引名称。</p>

<h2 id="elk">4.使ELK整体协作起来</h2>

<h3 id="section-12">4.1.原理</h3>

<ul>
  <li>logstash</li>
</ul>

<p>logstash主要用作收集数据使用，可以自由的定义数据的入口和出口，兼容多种数据源。</p>

<ul>
  <li>elasticsearch</li>
</ul>

<p>es和solr比较类似，都是基于lucene的来提供的搜索服务。但是在高并发的表现上，ES的负载均衡效果是优于solr的。</p>

<ul>
  <li>kibana</li>
</ul>

<p>kibana是一个可以可以用来查看ES里数据的Web。在早期logstash有一个logstash-web，但是功能比较简单。咱们这里说的kibana严格意义上说是kibana4，是在2015年重构完成的一个版本。</p>

<h3 id="el">4.2.E和L的连接</h3>
<p>其实就是把logstash收集到的数据写入es中，这里只要在logstash的启动参数上做配置就可以了，具体的配置文件如下：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>vi logstash-indexer.conf

input {
  file {
    type =&gt;"syslog"
    path =&gt; [ "/var/log/syslog" ]
  }
  syslog {
    type =&gt;"syslog"
    port =&gt;"5544"
  }
}
output {
  stdout { codec=&gt; rubydebug }
  elasticsearch {hosts =&gt; "localhost" }
}
</code></pre>
</div>

<ul>
  <li>配置介绍</li>
</ul>

<p>logstash的配置里，一定要有一个input和一个output。
file: 这里配置输入的文件信息。
syslog：把logstash配置为一个可接收syslog服务器来接收file里变化的数据。
output里定义了两处输出，分别是<strong>stdout</strong>命令行和<strong>elasticsearch</strong>。</p>

<ul>
  <li>启动</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>nohup ./logstash agent -f logstash-indexer.conf &gt; nohup &amp;
</code></pre>
</div>

<h3 id="kibana-1">4.3.Kibana的配置</h3>
<p>只需要修改kibana.yml中es的地址就可以了。</p>

<h3 id="es-1">4.4.ES</h3>
<p>ES在这个架构中作为数据存储和索引的系统。无额外的特殊配置。</p>

<h3 id="section-13">5.小结</h3>
<p>ELK架构在处理运维系统的日志分析以及一些数据量不是很大的场景还是很实用的。快速、简单、易扩展，企业中使用可以考虑使用hdfs作为es的数据存储来使用，具体性能需要根据实际的业务复杂度来衡量，复杂度不是很高的海量数据统计，可优先考虑使用elk方案。</p>

<p>参考地址：
http://baidu.blog.51cto.com/71938/1676798
https://www.gitbook.com/book/chenryn/kibana-guide-cn/details</p>


        </article>

        
        <hr>
        
        
            
            
                
                    
                
                    
                
                    
                
                    
                
            
        
            
            
                
                    
                
                    
                
                    
                
                    
                
            
        
            
            
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
            
        
            
            
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
            
        
            
            
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
            
        
            
            
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
            
        
            
            
                
                    
                
                    
                
                    
                
                    
                
            
        
            
            
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
            
        
            
            
                
                    
                
                    
                
                    
                
                    
                
            
        
            
            
                
                    
                
                    
                
                    
                
                    
                
            
        
        


        <h2 id="comments">订阅号</h2>
        <img src="http://7xriy2.com1.z0.glb.clouddn.com/leocook.jpg" /><br />


        <h2 id="comments">Comments</h2>
        


<div id="disqus_thread"></div>
<script>
    /**
     * RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
     * LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
     */

    var disqus_config = function() {
        this.page.url = 'http://leocook.github.io/2016/07/20/ELK%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE%E4%BB%8B%E7%BB%8D/'; // Replace PAGE_URL with your page's canonical URL variable
        this.page.identifier = 'http://leocook.github.io/2016/07/20/ELK%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE%E4%BB%8B%E7%BB%8D/'; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };

    (function() { // DON'T EDIT BELOW THIS LINE
        var d = document,
            s = d.createElement('script');

        s.src = '//leocook.disqus.com/embed.js';

        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>




    </div>
    <button class="anchor"><i class="fa fa-anchor"></i></button>
    <div class="right">
        <div class="wrap">

            <!-- Content -->
            <div class="side content">
                <div>
                    Content
                </div>
                <ul id="content-side" class="content-ul">
                    <li><a href="#similar_posts">Similar Posts</a></li>
                    <li><a href="#comments">Comments</a></li>
                </ul>
            </div>
            <!-- 其他div框放到这里 -->
            <!-- <div class="side">bbbb</div> -->
        </div>
    </div>
</div>
<script>
/**
 * target _blank
 */
(function() {
    var aTags = document.querySelectorAll('article a')
    for (var i = 0; i < aTags.length; i++) {
        aTags[i].setAttribute('target', '_blank')
    }
}());
</script>
<script src="/js/scroll.min.js " charset="utf-8"></script>
<script src="/js/pageContent.js " charset="utf-8"></script>


    <footer class="site-footer">


  <div class="wrapper">
      <p class="description">
          
          小鸟的成长记录.
          
      </p>
        <p class="contact">
            Contact me at:
            
            <a href="https://github.com/leocook"><i class="fa fa-github" aria-hidden="true"></i></a>
            

            
            <a href="mailto:leocook@163.com"><i class="fa fa-envelope-o" aria-hidden="true"></i></a>
            

            
            <a href="http://weibo.com/wulinjq"><i class="fa fa-weibo" aria-hidden="true"></i></a>
            

            

            

            
        </p>
        <p class="power">
            <span>
                Site powered by <a href="https://jekyllrb.com/">Jekyll</a> & <a href="https://pages.github.com/">Github Pages</a>.
            </span>
            <span>
                Theme designed by <a href="https://github.com/Gaohaoyang">HyG</a>.
            </span>
        </p>

  </div>
</footer>
<script src="/js/main.js " charset="utf-8"></script>


  </body>

</html>
