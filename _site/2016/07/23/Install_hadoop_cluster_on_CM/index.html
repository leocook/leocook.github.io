<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Install_hadoop_cluster_on_cm</title>
    <meta name="description" content="对于Hadoop这个复杂的大系统，我们期望能有一个平台，可以对Hadoop的每一个部件都能够进行安装部署，以及细颗粒度的监控。Apache发行版的Hadoop可以使用Ambari；Cloudera公司的CDH版本Hadoop则可以使用Cloudera Manager（后面简称为CM）来统一管理和部署。咱们这里的操...">

    <link rel="shortcut icon" href="/favicon.ico?" type="image/x-icon">
    <link rel="icon" href="/favicon.ico?" type="image/x-icon">
    <link rel="stylesheet" href=" /css/fontawesome/css/font-awesome.min.css ">
    <link rel="stylesheet" href=" /css/main.css ">
    <link rel="canonical" href="http://leocook.github.io/2016/07/23/Install_hadoop_cluster_on_CM/">
    <link rel="alternate" type="application/rss+xml" title="leocook" href="http://leocook.github.io /feed.xml ">


    <script>
    // 百度统计代码
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?f1ad6f37c7565a0fbaf172ac83132650";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
    </script>


<script type='text/javascript'>
      var _vds = _vds || [];
      window._vds = _vds;
      (function(){
        _vds.push(['setAccountId', 'b628e9072406c903']);
        (function() {
          var vds = document.createElement('script');
          vds.type='text/javascript';
          vds.async = true;
          vds.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + 'dn-growing.qbox.me/vds.js';
          var s = document.getElementsByTagName('script')[0];
          s.parentNode.insertBefore(vds, s);
        })();
      })();
  </script>
</head>


  <body>

    <header>
    <div class="wrapper">
        <a href="/" class="brand">leocook</a>
        <small>Big-Data Dev Engineer</small>
        <button id="headerMenu" class="menu"><i class="fa fa-bars"></i></button>
        <nav id="headerNav">
            <ul>
                <li>
                    
                    <a href="/">
                    
                        <i class="fa fa-home"></i>Home
                    </a>
                </li>

                
                    
                    <li>
                        
                        <a href="/archive/">
                        
                            <i class="fa fa-archive"></i>Archives
                        </a>
                    </li>
                    
                
                    
                    <li>
                        
                        <a href="/category/">
                        
                            <i class="fa fa-th-list"></i>Categories
                        </a>
                    </li>
                    
                
                    
                    <li>
                        
                        <a href="/tag/">
                        
                            <i class="fa fa-tags"></i>Tags
                        </a>
                    </li>
                    
                
                    
                    <li>
                        
                        <a href="/collection/">
                        
                            <i class="fa fa-bookmark"></i>Collections
                        </a>
                    </li>
                    
                
                    
                    <li>
                        
                        <a href="/about/">
                        
                            <i class="fa fa-heart"></i>About
                        </a>
                    </li>
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            </ul>
        </nav>
    </div>
</header>


        <div class="page clearfix" post>
    <div class="left">
        <h1>Install_hadoop_cluster_on_cm</h1>
        <div class="label">

            <div class="label-card">
                <i class="fa fa-calendar"></i>2016-07-23
            </div>

            <div class="label-card">
                
            </div>

            <div class="label-card">
                
            </div>

            <div class="label-card">
            


<!-- <span class="point">•</span> -->
<span class="categories">
  <i class="fa fa-th-list"></i>
  
    
        <a href="/category/#hadoop" title="Category: hadoop" rel="category">hadoop</a>
    
  

  <!-- <span class="point">•</span> -->
</span>


            </div>

            <div class="label-card">
            
<!-- <span class="point">•</span> -->
<span class="pageTag">
  <i class="fa fa-tags"></i>
  
    
        <!--a href="/tag/#cm" title="Tag: cm" rel="tag">cm</a-->
        <a href="/tag/#cm" title="Tag: cm" rel="tag">cm</a>&nbsp;
    
        <!--a href="/tag/#hadoop" title="Tag: hadoop" rel="tag">hadoop</a-->
        <a href="/tag/#hadoop" title="Tag: hadoop" rel="tag">hadoop</a>
    
  

</span>

            </div>

        </div>
        <hr>
        <article itemscope itemtype="http://schema.org/BlogPosting">
        <ul id="markdown-toc">
  <li><a href="#cloudera-manager" id="markdown-toc-cloudera-manager">1.Cloudera Manager安装前准备</a>    <ul>
      <li><a href="#section" id="markdown-toc-section">1.1. 操作系统的优化</a></li>
      <li><a href="#section-1" id="markdown-toc-section-1">1.2. 数据的存放</a></li>
    </ul>
  </li>
  <li><a href="#cloudera-manager-1" id="markdown-toc-cloudera-manager-1">2.开始安装Cloudera Manager</a>    <ul>
      <li><a href="#cm" id="markdown-toc-cm">2.1.下载CM</a></li>
      <li><a href="#section-2" id="markdown-toc-section-2">2.2.配置私有软件仓库(如果不使用私有仓库，这里可以直接跳过)</a>        <ul>
          <li><a href="#section-3" id="markdown-toc-section-3">2.2.1.创建一个临时可以使用的远程仓库</a></li>
          <li><a href="#cm-1" id="markdown-toc-cm-1">2.2.2.配置安装CM所需要的私有仓库</a></li>
        </ul>
      </li>
      <li><a href="#cm-2" id="markdown-toc-cm-2">2.2.3.配置使用CM安装节点时会用到的仓库</a></li>
      <li><a href="#jdk" id="markdown-toc-jdk">2.2.4.配置节点的JDK</a></li>
      <li><a href="#cm-3" id="markdown-toc-cm-3">2.3.开始安装CM</a></li>
      <li><a href="#cm-4" id="markdown-toc-cm-4">2.4.使用CM安装集群</a></li>
    </ul>
  </li>
  <li><a href="#section-4" id="markdown-toc-section-4">3.注意事项</a>    <ul>
      <li><a href="#host" id="markdown-toc-host">3.1.主机的Host配置不能出差错</a></li>
      <li><a href="#cm-agent" id="markdown-toc-cm-agent">3.2.cm-agent安装失败重试时</a></li>
    </ul>
  </li>
  <li><a href="#section-5" id="markdown-toc-section-5">4.会用到的一些地址总结</a>    <ul>
      <li><a href="#mysql" id="markdown-toc-mysql">4.1.Mysql的相关配置</a></li>
      <li><a href="#section-6" id="markdown-toc-section-6">4.2.创建本地仓库</a></li>
      <li><a href="#parcel" id="markdown-toc-parcel">4.3.parcel的下载地址</a></li>
      <li><a href="#cm-5" id="markdown-toc-cm-5">4.4.cm的下载地址</a></li>
    </ul>
  </li>
  <li><a href="#section-7" id="markdown-toc-section-7">5.附件</a></li>
</ul>

<p>对于Hadoop这个复杂的大系统，我们期望能有一个平台，可以对Hadoop的每一个部件都能够进行安装部署，以及细颗粒度的监控。Apache发行版的Hadoop可以使用Ambari；Cloudera公司的CDH版本Hadoop则可以使用Cloudera Manager（后面简称为CM）来统一管理和部署。咱们这里的操作系统使用的是ubuntu14.04.</p>

<h2 id="cloudera-manager">1.Cloudera Manager安装前准备</h2>

<h3 id="section">1.1. 操作系统的优化</h3>
<ul>
  <li>打开的最大文件数
修改当前的session配置(临时)：</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>ulimit -SHn 65535
</code></pre>
</div>

<p>永久修改（需要重启服务器）：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>sudo echo "ulimit -SHn 65535" &gt;&gt; /etc/rc.local
sudo chmod +x /etc/rc.local
</code></pre>
</div>

<ul>
  <li>打开的组大文件句柄数
临时配置</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code># 一般可不做修改，这是临时配置
sudo echo 2000000 &gt; /proc/sys/fs/file-max
</code></pre>
</div>

<p>永久配置</p>

<div class="highlighter-rouge"><pre class="highlight"><code>echo "echo 2000000 &gt; /proc/sys/fs/file-max" &gt;&gt; /etc/rc.local
</code></pre>
</div>

<p>或者</p>

<div class="highlighter-rouge"><pre class="highlight"><code>sudo echo "fs.file-max = 2000000" &gt;&gt;/etc/sysctl.conf #推荐
#使文件生效sudo /sbin/sysctl -p
</code></pre>
</div>

<ul>
  <li>打开的最大网络连接数</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>sudo echo "net.core.somaxconn = 2048" &gt;&gt;/etc/sysctl.conf
sudo /sbin/sysctl -p
</code></pre>
</div>

<ul>
  <li>关闭selinux</li>
</ul>

<p>ubuntu默认是不安装的selinux的，所以这里可以直接忽略。</p>

<ul>
  <li>配置ntp</li>
</ul>

<p>安装</p>

<div class="highlighter-rouge"><pre class="highlight"><code>apt-get install ntp
</code></pre>
</div>

<p>如果只需要保证集群内部的各个server之间时间保持同步，只需要在需要同步的机器上配置：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>0 */12 * * * ntpdate dt-vt-154
</code></pre>
</div>

<p>如果需要时间和互联网的时间保持一致，那么就需要在提供ntp server的机器上配置上层ntpserver:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>server [ntpserver_01]
server [ntpserver_02]
server [ntpserver_03]
</code></pre>
</div>

<ul>
  <li>关闭防火墙</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>sudo ufw disable #关闭防火墙
apt-get remove iptables #卸载防火墙
</code></pre>
</div>

<ul>
  <li>配置好hosts映射文件</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>vi /etc/hosts

192.168.1.151   dt-vt-151
192.168.1.152   dt-vt-152
192.168.1.153   dt-vt-153
192.168.1.154   dt-vt-154
</code></pre>
</div>

<ul>
  <li>Java环境配置</li>
</ul>

<p>安装</p>

<div class="highlighter-rouge"><pre class="highlight"><code>mkdir /opt/java
cd /opt/java
#下载到安装文件到这个目录
</code></pre>
</div>

<p>环境配置</p>

<div class="highlighter-rouge"><pre class="highlight"><code>vi /etc/profile

export JAVA_HOME=/opt/java/jdk1.7.0_79
export CLASSPATH=.:$JAVA_HOME/lib
export PATH=$JAVA_HOME/bin:$PATH
</code></pre>
</div>

<p>执行下面命令，使当前的session生效：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>source /etc/profile
</code></pre>
</div>

<h3 id="section-1">1.2. 数据的存放</h3>
<p>在使用CM来管理集群的时候，会涉及到大量的数据存储，例如Hadoop的主机列表信息，主机的配置信息，负载信息，各个模块的运行时状态等等。
咱们这里使用mysql来作为CM的数据存储，这里不仅是CM，Hadoop中的Hive等模块的元数据，都来使用mysql存储。</p>

<ul>
  <li>安装mysql</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>sudo apt-get install mysql-server
</code></pre>
</div>

<p>我这里安装完后是5.5.49.</p>

<ul>
  <li>关闭mysql，备份配置文件</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>/etc/init.d/mysql stop
</code></pre>
</div>

<p>把/var/lib/mysql/ib_logfile0和/var/lib/mysql/ib_logfile1拷贝至某个配置目录中，例如：/var/lib/mysql/bak</p>

<ul>
  <li>配置InnoDB引擎</li>
</ul>

<p>务必使用InnoDB引擎引擎，若是使用MyISAM引擎CM将启动不了。在Mysql的命令行中运行下面的命令，来查看你的Mysql使用了哪个引擎。</p>

<div class="highlighter-rouge"><pre class="highlight"><code>mysql&gt; show table status;
</code></pre>
</div>

<ul>
  <li>配置mysql的innodb刷写模式</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>innodb_flush_method=O_DIRECT
</code></pre>
</div>

<p>即：配置Innodb的刷写模式为异步写模式。</p>

<ul>
  <li>修改mysql的最大连接数</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>max_connections=1550
</code></pre>
</div>

<p>在这里，你应该会考虑配置该数值为多少比较合适。
当集群规模<strong>小于50台</strong>的时候，假设该库中有N个数据库是用来服务于Hadoop的，那么max_connections可以设置为100*N+50。例如：Cloudera Manager Server, Activity Monitor, Reports Manager, Cloudera Navigator, 和 Hive metastore都是使用mysql的，那么就配置max_connections为550.
当集群规模<strong>大于50台</strong>的时候，建议每个数据库只存放在一台机器上。</p>

<ul>
  <li>配置文件样例</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>[mysqld]
transaction-isolation = READ-COMMITTED
# Disabling symbolic-links is recommended to prevent assorted security risks;
# to do so, uncomment this line:
# symbolic-links = 0

key_buffer = 16M
key_buffer_size = 32M
max_allowed_packet = 32M
thread_stack = 256K
thread_cache_size = 64
query_cache_limit = 8M
query_cache_size = 64M
query_cache_type = 1

max_connections = 1550
#expire_logs_days = 10
#max_binlog_size = 100M


# InnoDB settings
innodb_file_per_table = 1
innodb_flush_log_at_trx_commit  = 2
innodb_log_buffer_size = 64M
innodb_buffer_pool_size = 4G
innodb_thread_concurrency = 8
innodb_flush_method = O_DIRECT
innodb_log_file_size = 512M

[mysqld_safe]
log-error=/var/log/mysqld.log
pid-file=/var/run/mysqld/mysqld.pid

</code></pre>
</div>

<ul>
  <li>启动mysql</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>/etc/init.d/mysql start
</code></pre>
</div>

<p>打开开机自启</p>

<div class="highlighter-rouge"><pre class="highlight"><code>apt-get install sysv-rc-conf
sysv-rc-conf mysql on
</code></pre>
</div>

<ul>
  <li>安装mysql-jdbc驱动</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>apt-get install libmysql-java
</code></pre>
</div>

<ul>
  <li>mysql远程连接</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>vi /etc/mysql/my.cnf

bind-address = 0.0.0.0
</code></pre>
</div>

<ul>
  <li>給相关服务创建mysql的数据库</li>
</ul>

<p>相关列表如下：</p>

<table>
  <thead>
    <tr>
      <th>Role</th>
      <th>Database</th>
      <th>User</th>
      <th>Password</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Activity Monitor</td>
      <td>amon</td>
      <td>amon</td>
      <td>amon_password</td>
    </tr>
    <tr>
      <td>Reports Manager</td>
      <td>rman</td>
      <td>rman</td>
      <td>rman_password</td>
    </tr>
    <tr>
      <td>Hive Metastore Server</td>
      <td>hive_metastore</td>
      <td>hive</td>
      <td>hive_password</td>
    </tr>
    <tr>
      <td>Sentry Server</td>
      <td>sentry</td>
      <td>sentry</td>
      <td>sentry_password</td>
    </tr>
    <tr>
      <td>Cloudera Navigator Audit Server</td>
      <td>nav</td>
      <td>nav</td>
      <td>nav_password</td>
    </tr>
    <tr>
      <td>Cloudera Navigator Metadata Server</td>
      <td>navms</td>
      <td>navms</td>
      <td>navms_password</td>
    </tr>
    <tr>
      <td>OOZIE</td>
      <td>oozie</td>
      <td>oozie</td>
      <td>oozie</td>
    </tr>
  </tbody>
</table>

<p>建表语句格式如下：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>create database database DEFAULT CHARACTER SET utf8;
grant all on database.* TO 'user'@'%' IDENTIFIED BY 'password';
</code></pre>
</div>

<p>建表语句如下：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>create database amon DEFAULT CHARACTER SET utf8;
grant all on amon.* TO 'amon'@'%' IDENTIFIED BY 'amon';

create database rmon DEFAULT CHARACTER SET utf8;
grant all on rmon.* TO 'rmon'@'%' IDENTIFIED BY 'rmon';

create database hive_metastore DEFAULT CHARACTER SET utf8;
grant all on hive_metastore.* TO 'hive'@'%' IDENTIFIED BY 'hive';

create database sentry DEFAULT CHARACTER SET utf8;
grant all on sentry.* TO 'sentry'@'%' IDENTIFIED BY 'sentry';

create database nav DEFAULT CHARACTER SET utf8;
grant all on nav.* TO 'nav'@'%' IDENTIFIED BY 'nav';

create database navms DEFAULT CHARACTER SET utf8;
grant all on navms.* TO 'navms'@'%' IDENTIFIED BY 'navms';

create database oozie DEFAULT CHARACTER SET utf8;
grant all on oozie.* TO 'oozie'@'%' IDENTIFIED BY 'oozie';
</code></pre>
</div>

<h2 id="cloudera-manager-1">2.开始安装Cloudera Manager</h2>

<h3 id="cm">2.1.下载CM</h3>

<p>可以下载安装最新版本的CM：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>wget http://archive.cloudera.com/cm5/installer/latest/cloudera-manager-installer.bin
</code></pre>
</div>

<p>当然，如果你想选择安装其它版本，可以访问下面的地址，并选择下载你所需要的版本(cm5+)：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>http://archive.cloudera.com/cm5/installer/
</code></pre>
</div>

<p>我这里使用的是版本是5.4.10，从release note上看，目前cdh5.4.10是最稳当的版本。我下载到了本地路径如下：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>/opt/cm/cloudera-manager-installer.bin
</code></pre>
</div>

<p>修改权限，使其可以被执行：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>chmod u+x cloudera-manager-installer.bin
</code></pre>
</div>

<h3 id="section-2">2.2.配置私有软件仓库(如果不使用私有仓库，这里可以直接跳过)</h3>

<h4 id="section-3">2.2.1.创建一个临时可以使用的远程仓库</h4>
<p>这个配置是在安装cloudera-manager-server的时候才会用的。这里的仓库是使用传统的http协议，通过网络传输数据的。可以去http://archive.cloudera.com/cm5/repo-as-tarball/下载你所需要的cdh包。</p>

<ul>
  <li>解压安装包</li>
</ul>

<p>下载完安装包后，解压到某个目录下，我这里下载的是cm5.4.10-ubuntu14-04.tar.gz这个版本。</p>

<div class="highlighter-rouge"><pre class="highlight"><code>tar -zxvf cm5.4.10-ubuntu14-04.tar.gz
chmod -R ugo+rX /opt/cm/local_resp/cm
</code></pre>
</div>

<p>解压后的目录是/opt/cm/local_resp/cm</p>

<ul>
  <li>启动Http server</li>
</ul>

<p>启动一个Http服务，使可以通过网络来访问仓库中的数据。</p>

<div class="highlighter-rouge"><pre class="highlight"><code>cd /opt/cm/
python -m SimpleHTTPServer 8900
</code></pre>
</div>

<p>我这里使用的是8900，你可以根据需要，使用指定的端口。</p>

<ul>
  <li>验证</li>
</ul>

<p>可在浏览器中访问地址http://server:8900/cm，如果可以正常访问，并且能看到相对应的文件列表，则表示正常启动。</p>

<h4 id="cm-1">2.2.2.配置安装CM所需要的私有仓库</h4>

<p>在目录<strong>/etc/apt/sources.list.d/</strong>下创建文件<strong>my-private-cloudera-repo.list</strong>，并写入配置把这个文件和上面新建的仓库关联到一起：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>vi /etc/apt/sources.list.d/my-private-cloudera-repo.list

deb [arch=amd64] http://192.168.1.154:8900/cm/ trusty-cm5.4.10 contrib
</code></pre>
</div>

<p>执行下面的命令，使得上面的配置生效：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>sudo apt-get update
</code></pre>
</div>

<h3 id="cm-2">2.2.3.配置使用CM安装节点时会用到的仓库</h3>
<p>可以下载地址：http://archive.cloudera.com/cm5/ubuntu/trusty/amd64/cm/ 里的所有内容到本地，然后使用<strong>2.2.1</strong>中的方式来启动一个Http server。</p>

<h3 id="jdk">2.2.4.配置节点的JDK</h3>
<p>这一步是可选的，如果你不想每台机器都去手动安装，也可以在后边使用CM来批量安装。</p>

<h3 id="cm-3">2.3.开始安装CM</h3>
<ul>
  <li>连接互联网安装</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>sudo ./cloudera-manager-installer.bin
</code></pre>
</div>

<p>或者</p>

<ul>
  <li>使用本地仓库安装</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>sudo ./cloudera-manager-installer.bin --skip_repo_package=1
</code></pre>
</div>

<p>然后就是一路的YES &amp; NEXT，最后安装完成，CM默认的端口是7180，账户名和密码都是7180.</p>

<h3 id="cm-4">2.4.使用CM安装集群</h3>

<p>首次登陆CM管理界面的时候，会出现一个集群安装向导。我这里选择的是免费版本。然后大概有如下几步：</p>

<ul>
  <li>
    <p>使用ip或者hostname来搜索主机，搜索到之后，go to next step.</p>
  </li>
  <li>
    <p>看到如下图片的时候，如果你已经在前面的主机中安装好了JDK，那么这里可以不选，如果没有，则必须选择。</p>
  </li>
</ul>

<p><img src="http://7xriy2.com1.z0.glb.clouddn.com/cm-02.png" alt="CM JDK" title="cm jdk" /></p>

<ul>
  <li>选择是否使用单用户模式（Single User Mode）</li>
</ul>

<p>不使用该模式的话，HDFS服务会使用“hdfs”账户来启动，Hbase的Region Server会使用“hbase”账户来启动。使用了该模式之后，所有的服务都是使用同一个账户去启动的。
这里主要看集群的使用场景，如果其中涉及到不同的模块是由不同人员来运维管理的话，我建议还是不要使用单用户模式了。但如果集群是统一由一个人员来管理，那么选择使用单用户模式可能会方便很多。
我这里没有使用单用户模式。</p>

<ul>
  <li>配置好SSH登录</li>
</ul>

<p><img src="http://7xriy2.com1.z0.glb.clouddn.com/cm-03.png" alt="配置ssh登录信息" title="输入密码" /></p>

<ul>
  <li>
    <p>配置好SSH后开始连入主机，安装jdk和cm-agent
<img src="http://7xriy2.com1.z0.glb.clouddn.com/cm-04.png" alt="install cm agent" title="install cm agent" /></p>
  </li>
  <li>
    <p>安装完成，此时cm-agent就已经安装好了，随时都可以使用cm-server控制安装Hadoop的相关组件,完成后先不要点击进入下一步，继续看下面。
<img src="http://7xriy2.com1.z0.glb.clouddn.com/cm-05.png" alt="cm agent ok" title="cm agent ok" /></p>
  </li>
  <li>
    <p>分发Hadoop的安装包</p>
  </li>
</ul>

<p>去地址：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>http://archive.cloudera.com/cdh5/parcels/5.4.10/
</code></pre>
</div>

<p>下载：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>CDH-5.4.10-1.cdh5.4.10.p0.16-trusty.parcel
CDH-5.4.10-1.cdh5.4.10.p0.16-trusty.parcel.sha1
manifest.json
</code></pre>
</div>

<p>下载完成后：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>把"CDH-5.4.10-1.cdh5.4.10.p0.16-trusty.parcel.sha1"重命名为"CDH-5.4.10-1.cdh5.4.10.p0.16-trusty.parcel.sha"
</code></pre>
</div>

<p>并移到目录：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>/opt/cloudera/parcel-repo
</code></pre>
</div>

<p>然后在cm-serve点击进入下一页，将会看到如下图：
<img src="http://7xriy2.com1.z0.glb.clouddn.com/cm-06.png" alt="cm parcel distributed" title="cm parcel distributed" />
因为你已经把安装包下载好，并且放入到/opt/cloudera/parcel-repo（默认的目录）里面，所以这里的<strong>Download</strong>自然就是100%，<strong>Distributed</strong>是把安装包从cm-server往集群中各个节点分发的过程，<strong>Unpacked</strong>是表示各个节点的上安装包的解压情况进度，前面都OK后，<strong>Activated</strong>自然就可以了，表示安装包已经部署好了，可以随时进行安装。</p>

<ul>
  <li>
    <p>选择安装Hadoop的那些组件之后，会在这里显示各个组件部署的主机地址。
<img src="http://7xriy2.com1.z0.glb.clouddn.com/cm-07.png" alt="hosts choose" title="hosts choose" /></p>
  </li>
  <li>
    <p>这里配置的是一些组件使用的mysql信息：
<img src="http://7xriy2.com1.z0.glb.clouddn.com/cm-08.png" alt="hadoop mysql config" title="hadoop mysql config" /></p>
  </li>
  <li>
    <p>然后可以配置一些服务的的具体参数
<img src="http://7xriy2.com1.z0.glb.clouddn.com/cm-09.png" alt="hadoop config" title="hadoop config" /></p>
  </li>
  <li>
    <p>参数配置都没问题后，开始执行安装。
<img src="http://7xriy2.com1.z0.glb.clouddn.com/cm-10.png" alt="hadoop install" title="hadoop install" /></p>
  </li>
  <li>
    <p>安装完成后。
<img src="http://7xriy2.com1.z0.glb.clouddn.com/cm-11.jpeg" alt="install success" title="install success" />
PS：我这里的Kafka是后来安装上去的，默认Hadoop的parcel包是没有kafka的。</p>
  </li>
</ul>

<h2 id="section-4">3.注意事项</h2>

<h3 id="host">3.1.主机的Host配置不能出差错</h3>
<p>我就配置错过host，期间走了一些弯路，主要表现在添加完主机之后，Hosts下的主机名都是localhost。</p>

<h3 id="cm-agent">3.2.cm-agent安装失败重试时</h3>
<p>如果在重试的过程中出现了一直等待，或者cm-agent端口被占用的情况，大概有下面的几种情况：</p>

<ul>
  <li>锁文件没有删除</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>sudo rm /tmp/.scm_prepare_node.lock
</code></pre>
</div>

<ul>
  <li>端口被占用 <strong>9000/9001</strong></li>
</ul>

<p>这种情况是部分进程没有关闭成功，找到端口对应的进程号，然后然后使用<strong>kill -9停止进程</strong></p>

<div class="highlighter-rouge"><pre class="highlight"><code>netstat -nap | grep 9000
netstat -nap | grep 9001
</code></pre>
</div>

<p>主要是<strong>supervisor</strong>和<strong>cm-agent</strong>进程</p>

<h2 id="section-5">4.会用到的一些地址总结</h2>

<h3 id="mysql">4.1.Mysql的相关配置</h3>
<p>http://www.cloudera.com/documentation/enterprise/5-4-x/topics/cm_ig_mysql.html</p>

<h3 id="section-6">4.2.创建本地仓库</h3>

<ul>
  <li>For CM</li>
</ul>

<p>http://www.cloudera.com/documentation/enterprise/5-4-x/topics/cm_ig_create_local_package_repo.html</p>

<ul>
  <li>For parcel</li>
</ul>

<p>http://www.cloudera.com/documentation/enterprise/5-4-x/topics/cm_ig_create_local_parcel_repo.html</p>

<h3 id="parcel">4.3.parcel的下载地址</h3>

<p>http://archive.cloudera.com/cdh5/parcels/
http://archive.cloudera.com/kafka/parcels/</p>

<h3 id="cm-5">4.4.cm的下载地址</h3>

<p>加压后可以直接运行
http://archive.cloudera.com/cm5/cm/5/</p>

<h2 id="section-7">5.附件</h2>

<p>博文中的图片是压缩后的，清晰度比较低，原图可以访问下面的地址：</p>

<p>链接: http://pan.baidu.com/s/1cmiBCE 密码: rnmw</p>

        </article>
        <hr>
        
        
            
            
                
                    
                
                    
                
            
                
                    
                
                    
                
            
        
            
            
                
                    
                
                    
                
            
        
            
            
                
                    
                
                    
                
            
        
            
            
                
                    
                
                    
                
            
        
            
            
                
                    
                
                    
                
            
                
                    
                
                    
                
            
        
            
            
                
                    
                
                    
                
            
                
                    
                
                    
                
            
                
                    
                
                    
                
            
                
                    
                
                    
                
            
        
            
            
                
                    
                
                    
                        
                        <h2 id="similar_posts">Similar Posts</h2>
                        <ul>
                        
                        <li class="relatedPost">
                            <a href="http://leocook.github.io/2016/05/17/Tez%E7%B3%BB%E5%88%97%E7%AC%AC%E4%B8%89%E7%AF%87-Tez%E5%92%8Coozie%E6%95%B4%E5%90%88/">Tez系列第三篇 Tez和oozie整合
                            
                            </a>
                        </li>
                        
                        
                    
                
            
                
                    
                
                    
                
            
                
                    
                
                    
                
            
                
                    
                
                    
                
            
        
            
            
                
                    
                
                    
                        
                        <li class="relatedPost">
                            <a href="http://leocook.github.io/2016/05/09/Tez%E7%B3%BB%E5%88%97%E7%AC%AC%E4%BA%8C%E7%AF%87-hive_on_tez/">Tez系列第二篇 Hive_on_tez
                            
                            </a>
                        </li>
                        
                        
                    
                
            
                
                    
                
                    
                
            
                
                    
                
                    
                
            
        
            
            
                
                    
                
                    
                        
                        <li class="relatedPost">
                            <a href="http://leocook.github.io/2016/04/01/Tez%E7%B3%BB%E5%88%97%E7%AC%AC%E4%B8%80%E7%AF%87-%E5%9F%BA%E7%A1%80%E5%B8%B8%E8%AF%86/">Tez系列第一篇 基础常识
                            
                            </a>
                        </li>
                        
                        
                    
                
            
                
                    
                
                    
                
            
        
            
            
                
                    
                
                    
                        
                        <li class="relatedPost">
                            <a href="http://leocook.github.io/2016/03/13/hadoop%E4%BC%98%E5%8C%96-yarn/">Hadoop优化 Yarn
                            
                            </a>
                        </li>
                        
                        
                    
                
            
                
                    
                
                    
                
            
        
        
            </ul>
        


        <h2 id="comments">Comments</h2>
        
<!-- 多说评论框 start -->
<div class="ds-thread" data-thread-key="http://leocook.github.io/2016/07/23/Install_hadoop_cluster_on_CM/" data-title="Install_hadoop_cluster_on_cm" data-url="http://leocook.github.io/2016/07/23/Install_hadoop_cluster_on_CM/"></div>
<!-- 多说评论框 end -->
<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
<script type="text/javascript">
    var duoshuoQuery = {
        short_name: "leocook"
    };
    (function() {
        var ds = document.createElement('script');
        ds.type = 'text/javascript';
        ds.async = true;
        ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
        ds.charset = 'UTF-8';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
</script>
<!-- 多说公共JS代码 end -->






    </div>
    <button class="anchor"><i class="fa fa-anchor"></i></button>
    <div class="right">
        <div class="wrap">

            <!-- Content -->
            <div class="side content">
                <div>
                    Content
                </div>
                <ul id="content-side" class="content-ul">
                    <li><a href="#similar_posts">Similar Posts</a></li>
                    <li><a href="#comments">Comments</a></li>
                </ul>
            </div>
            <!-- 其他div框放到这里 -->
            <!-- <div class="side">bbbb</div> -->
        </div>
    </div>
</div>
<script>
/**
 * target _blank
 */
(function() {
    var aTags = document.querySelectorAll('article a')
    for (var i = 0; i < aTags.length; i++) {
        aTags[i].setAttribute('target', '_blank')
    }
}());
</script>
<script src="/js/scroll.min.js " charset="utf-8"></script>
<script src="/js/pageContent.js " charset="utf-8"></script>


    <footer class="site-footer">


  <div class="wrapper">
      <p class="description">
          
          小鸟的成长记录.
          
      </p>
        <p class="contact">
            Contact me at:
            
            <a href="https://github.com/leocook"><i class="fa fa-github" aria-hidden="true"></i></a>
            

            
            <a href="mailto:leocook@163.com"><i class="fa fa-envelope-o" aria-hidden="true"></i></a>
            

            
            <a href="http://weibo.com/wulinjq"><i class="fa fa-weibo" aria-hidden="true"></i></a>
            

            

            

            
        </p>
        <p class="power">
            <span>
                Site powered by <a href="https://jekyllrb.com/">Jekyll</a> & <a href="https://pages.github.com/">Github Pages</a>.
            </span>
            <span>
                Theme designed by <a href="https://github.com/Gaohaoyang">HyG</a>.
            </span>
        </p>

  </div>
</footer>
<script src="/js/main.js " charset="utf-8"></script>


  </body>

</html>
